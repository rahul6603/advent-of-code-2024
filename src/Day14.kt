fun main() {

    fun getQuadrant(x: Int, y: Int, width: Int, height: Int): Int {
        if (x == width / 2 || y == height / 2) return -1
        val xQuadrant = if (x < width / 2) 0 else 1
        val yQuadrant = if (y < height / 2) 0 else 1
        return xQuadrant + yQuadrant * 2
    }

    fun part1(input: List<List<Int>>, width: Int, height: Int): Int {
        val quadrants = mutableListOf(0, 0, 0, 0)
        for (inputList in input) {
            var (x, y, dx, dy) = inputList
            x = (x + 100 * dx).mod(width)
            y = (y + 100 * dy).mod(height)
            val quadrant = getQuadrant(x, y, width, height)
            if (quadrant != -1) quadrants[quadrant] += 1
        }
        return quadrants.reduce { acc, i -> acc * i }
    }

    fun isClustered(grid: List<MutableList<Char>>): Boolean {
        val radius = 3
        for (y in grid.indices) {
            for (x in grid[0].indices) {
                if (grid[y][x] == '#') {
                    var isClustered = true
                    outer@ for (i in -radius..radius) {
                        for (j in -radius..radius) {
                            if (x + i in grid[0].indices && y + j in grid.indices) {
                                if (grid[y + j][x + i] != '#') {
                                    isClustered = false
                                    break@outer
                                }
                            }
                        }
                    }
                    if (isClustered) return true
                }
            }
        }
        return false
    }

    fun part2(input: List<List<Int>>, width: Int, height: Int): Int {
        for (seconds in 0..100000) {
            val grid = List(height) { MutableList(width) { '.' } }
            for (inputList in input) {
                var (x, y, dx, dy) = inputList
                x = (x + seconds * dx).mod(width)
                y = (y + seconds * dy).mod(height)
                grid[y][x] = '#'
            }
            if (isClustered(grid)) {
                println(grid.joinToString("\n") { it.joinToString("") })
                return seconds
            }
        }
        return -1
    }

    val input = readInput("Day14").map { it.split(',', '=', ' ').mapNotNull { it.toIntOrNull() } }
    val (width, height) = Pair(101, 103)
    println(part1(input, width, height))
    println(part2(input, width, height))

    /* PART TWO CHRISTMAS TREE
    .............................................#.......................................................
    .....................................................................................................
    ...............................................#.....................................................
    ...........#................................#........................................................
    ..........#..........................................................................................
    ...................................................................................#..#..............
    ..............................................................#......................................
    .....................................................................................................
    ......................................#..............................................................
    ............................................................#........................................
    .....................................................................................................
    ...........#...............#............#...................#........................................
    .....................................................................................................
    .....................#...............................................................................
    .............#.......................................................................................
    ..................................................................................................#..
    ...................................#.................................................................
    ...........#.........................................................................................
    .......................................#.............................................................
    .................#......................#.............................................#..............
    ......#.........#.......................................................#..............#............#
    .....................................................................................................
    ............#....................................#...................................................
    .................#.........................#.........................................................
    ...............................................................................#.....................
    .....................................................................................................
    ............................................................................................#.#......
    ....#..............................................#........#........................................
    ................#...........#........................................................................
    .....................................................................................................
    ...................................###############################......................#..........#.
    .....................#.............#.............................#....#....................#.........
    ......#............................#.............................#...................................
    ...................................#.............................#...................................
    #..................................#.............................#.........#.........................
    ................#..................#..............#..............#...............................#...
    ...................................#.............###.............#...................................
    ...................................#............#####............#...................................
    ............#......................#...........#######...........#......................#............
    ...................................#..........#########..........#..................#................
    ........................#..........#............#####............#...................................
    .........#.........................#...........#######...........#.......................#...........
    .............................#.....#..........#########..........#.....................#.............
    .......................#...........#.........###########.........#...................................
    .........#.........................#........#############........#...................................
    ...................................#..........#########..........#..............................#....
    .....................#.............#.........###########.........#...................................
    #..................................#........#############........#...................................
    ...................................#.......###############.......#...................................
    .....................#.............#......#################......#...................................
    ...................................#........#############........#.........................#.........
    ........................#..........#.......###############.......#...................................
    ...................................#......#################......#.....#.............................
    ...................................#.....###################.....#...................................
    ..#...#............................#....#####################....#.#.................................
    .........#.........................#.............###.............#....................#..............
    .............#.....................#.............###.............#...............#...................
    ...................................#.............###.............#..................#................
    #..................................#.............................#...........................#......#
    ...................................#.............................#....#..............................
    ...................................#.............................#...................................
    ...........#.......................#.............................#...................................
    ...#............................#..###############################......................#...#........
    ...............................................................................................#.....
    .#................#..................................................................................
    .........#................#..............................................#...........................
    ....#..............#.................................................................................
    ....#................................................................................#...............
    .....................................#...............................................................
    .............#..................................................................#....................
    ............#..............................#.........................................................
    ............................................................................#......#.................
    .#.................#.................................................................................
    ..........................#.............................#....................................#.......
    ..................................................#..................................................
    .....................................................................................................
    ..............................#......................................................................
    .....................#...............................................................................
    .....................................................................................................
    .....................................................................................................
    ...........................#....................#.......................................#............
    ............................................................................#........................
    ...............#.................................#...................#...............................
    ......................................#....#.........................................................
    .....................................................................................................
    ...................................#...............#...............................#.....#...........
    .................................................#...................................................
    ......................................................................#..............................
    ........................................#............................................................
    ..........#............................#.............................................................
    .....................................................................................................
    .........................#..................................................................#........
    .....................................................................................................
    .....................................................................................................
    .............................#.........................................#..........#.........#........
    .........................#.......................................#...................................
    ...............................................................................................#.....
    ....................................................................................................#
    .....................................................................................................
    ..........#..............................#................................#..........................
    .....................................................................................#...............
    .........................................#......................................#....................
    ....................................................##.#...........................................#.
    */
}